# Leetcode 1434. 每个人戴不同帽子的方案数

位运算 + DP

10个人, 40种帽子  
由于人/帽子相互独立, 适合用位运算标记状态

接着选取基准状态, 选人`2^10`, 选帽子`2^40`  
显然用人来标记状态

于是方案数可以描述为`dp[s][i]`

`s`表示人群状态。  
假设有3人, 则`0b000`即`0`表示没有人分配到帽子, `0b001`即`1`表示第一个人分配到帽子, `0b010`即`2`表示第二个分配到帽子, 以此类推

`i`表示已经分配了i顶帽子。
假设有3人, `dp[0b001][1]`表示分配了1顶帽子时, 且只有第一个人被分配到帽子的方案数。

问题转化为, 给定`n`个人, `m`顶帽子, 求`dp[2^n - 1][m]`即`dp[0b11111...1][m]`

$$
dp[s][i] = \begin{cases}
1 &s=0, i=0 \\
\sum dp[j][i-1] &j<s, i>1 \\
\end{cases}
$$

`j`与`s`二进制相差一位, 可以描述如下

$$
\begin{cases}
v = s - j &j<s \\
v = -v \& v &(lowbit)
\end{cases}
$$

可以看出每产生新的`dp[s][i]`约等于遍历之前产生的所有可用状态, 某种意义上和01背包有点相似, 进一步转换

i = 0 时, 还没有分配帽子
$$
dp[s] = \begin{cases}
1 &s=0 \\
0 &s>0 \\
\end{cases}
$$

i = 1 时, 分配第一顶帽子
$$
dp[s] = dp[s]_{old} +dp[j]
$$
且满足
$$
\begin{cases}
v = s - j &j<s \\
v = -v \& v &(lowbit)
\end{cases}
$$

以此类推

帽子与人的关系依然可以用位运算预处理, 后续步骤依照上述模仿01背包, 最终结果取`dp[2^n - 1]`
